- type: serial
  steps:

  #
  # build docker image and push to registry
  #

  - type: parallel
    steps:
    - service: staging_build_redis
      type: push
      image_name: gcr.io/flash2-staging/redis
      image_tag: "{{.CommitID}}"
      registry: https://gcr.io
      dockercfg_service: staging_gcr_dockercfg
      tag: ^(staging)
    
    - service: develop_build_redis
      type: push
      image_name: gcr.io/flash2-development/redis
      image_tag: "{{.CommitID}}"
      registry: https://gcr.io
      dockercfg_service: develop_gcr_dockercfg
      tag: ^(development)

    - service: prod_build_redis
      type: push
      image_name: gcr.io/flash2-production/redis
      image_tag: "{{.CommitID}}"
      registry: https://gcr.io
      dockercfg_service: prod_gcr_dockercfg
      tag: ^(production|feature/*)
